<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Projektowanie i implementacja systemów webowych - wykład 5</title>

  <meta name="description" content="Angular">
  <meta name="author" content="Maciej Małecki">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>reveal.js</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="dist/theme/night.css" id="theme">
  <link rel="stylesheet" href="css/custom.css">

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
</head>
<body>
<div class="reveal">
  <div class="slides">
    <section>
      <h2>Projekt i implementacja systemów webowych</h2>
      <p>Wykład 5: Tworzenie aplikacji SPA w Angularze</p>
      <p>mgr inż. Maciej Małecki</p>
    </section>

    <section>
      <h3>Architektura aplikacji SPA</h3>
      <img src="img/rich-front-architecture.svg" alt="Rich Front Architecture" class="backlight">
    </section>

    <section>
      <h3>Popularne frameworki</h3>
      <div class="r-hstack">
        <img src="img/React-icon.svg" alt="react">
        <img src="img/Angular_logo.svg" alt="ng">
        <img src="img/Vue.js_Logo.svg" alt="vue">
      </div>
    </section>

    <section>
      <h3>Angular: historia</h3>
      <div class="r-hstack">
        <img src="img/Angular_logo.svg" alt="ng" style="width: 400px;">
        <div>
          <ul>
            <li>AngularJS - Google, 2010</li>
            <li>AngularJS: LTS &zigrarr; 2021-12-31</li>
            <li class="fragment" data-fragment-index="1">Angular 2.0 - Google, 2016</li>
            <li class="fragment" data-fragment-index="1">Brak kompatybilności między Angular i&nbsp;AngularJS</li>
            <li class="fragment" data-fragment-index="2"><span class="bcol4">UWAGA:</span> zwracajcie uwagę na nazwy przeszukując zasoby sieciowe</li>
          </ul>
        </div>
      </div>
    </section>

    <section>
      <h3>Angular: architektura</h3>
      <img src="img/angular-architecture.png" alt="Angular Architecture" class="backlight white">
      <p class="most-text">Źródło: <a
          href="https://angular.io/guide/architecture">https://angular.io/guide/architecture</a>
      </p>
    </section>

    <section>
      <h3>Angular: środowisko developerskie</h3>
      <ul>
        <li><code>Node</code> - środowisko uruchomieniowe dla JavaScript</li>
        <li><code>NPM</code> - ang. <em>Node Package Manager</em> - zarządzanie zależnościami</li>
        <li><code>NPM registry</code> - repozytorium bibliotek</li>
        <li class="fragment"><code>TypeScript</code> - podstawowy język programowania dla Angular 2.x+</li>
        <li class="fragment"><code>Angular CLI</code> - narzędzie linii poleceń wspierające proces tworzenia i budowania</li>
        <li class="fragment"><code>Karma, Jasmine, JEST, Protractor, Cypress</code> - środowisko tworzenia testów</li>
      </ul>
    </section>

    <section>
      <h3>Środowisko developerskie w praktyce</h3>

      <section>
        <p>Instalacja node &zigrarr; <code>nvm</code></p>
        <p class="fragment" data-fragment-index="1">Instalacja <code>Angular CLI</code></p>
        <pre class="bash fragment" data-fragment-index="1"><code class="hljs" data-trim>
            npm install -g @angular/cli
          </code></pre>
      </section>

      <section>
        <p>Wygenerowanie aplikacji Angular</p>
        <pre class="text"><code class="hljs" data-trim>
            $ ng new
            ? What name would you like to use for the new workspace and initial project? foo
            ? Do you want to enforce stricter type checking and stricter bundle budgets in the workspace?
            This setting helps improve maintainability and catch bugs ahead of time.
            For more information, see https://angular.io/strict Yes
            ? Would you like to add Angular routing? Yes
            ? Which stylesheet format would you like to use? SCSS   [ https://sass-lang.com/documentation/syntax#scss                ]
          </code></pre>
      </section>

      <section>
        <p>Zbudowanie aplikacji</p>
        <pre class="text"><code class="hljs" data-trim>
          ng build --prod
        </code></pre>
        <p>Uruchomienie aplikacji</p>
        <pre class="text"><code class="hljs" data-trim>
          ng serve -o
        </code></pre>
      </section>
    </section>

    <section>
      <h3>Angular: podstawowe elementy</h3>
      <div class="r-vstack">
        <div class="r-hstack tile">
          <div class="bcol0">Moduły</div>
          <div class="bcol1">Komponenty</div>
          <div class="bcol2">Dyrektywy</div>
        </div>
        <div class="r-hstack tile">
          <div class="bcol3">Serwisy</div>
          <div class="bcol4">Router</div>
          <div class="bcol5">Formularze</div>
        </div>
      </div>
    </section>

    <section>
      <h3>Moduł (<code>NgModule</code>)</h3>

      <section>
        <ul>
          <li>funkcjonalny blok aplikacji,</li>
          <li>sposób organizacji kodu,</li>
          <li>sposób zarządzania zależnościami,</li>
          <li>tworzenie kodu bibliotecznego,</li>
          <li><em>lazy-loading</em> w przypadku dużych aplikacji.</li>
        </ul>
        <p class="fragment bcol0">Moduł ECMA Script oraz Moduł Angulara to dwie różne rzeczy!</p>
      </section>

      <section>
        <div class="r-hstack">
          <pre class="typescript"><code class="hljs" data-trim data-line-numbers="|2|3-7|8|10-11">
          @NgModule({
            imports: [CommonModule],
            declarations: [
              MyComponent1,
              MyComponent2,
              MyExternalComponent3
            ],
            exports: [MyExternalComponent3]
          })
          export class MyModule {
          }
          </code></pre>
          <div style="width: 1em;"></div>
          <div>
            <ul>
              <li><code>@NgModule</code> - dekorator TypeScript</li>
              <li>komponenty "należą" do modułu</li>
              <li>publiczne elementy modułu należy wyeksportować</li>
            </ul>
          </div>
        </div>
      </section>

      <section>
        <div class="r-hstack">
          <img src="img/angular-project-structure-ide.png" alt="Angular Project Structure in IDE" class="backlight white bigtile">
          <img src="img/angular-app-composition.svg" alt="Angular Application Composition" class="backlight bigtile">
        </div>
        <div>
          <ul>
            <li>Struktura katalogów może odzwierciedlać strukturę modułów.</li>
            <li>Przydaje się moduł <em>general</em> lub <em>shared</em>.</li>
          </ul>
        </div>
      </section>
    </section>

    <section>
      <h3>Komponent</h3>

      <section>
        <ul>
          <li>Komponent jest podstawową jednostką budowania warstwy wizualnej aplikacji.</li>
          <li>Komponent może być wykorzystywany wielokrotnie.</li>
          <li>Komponent komunikuje się ze światem "zewnętrznym" w ściśle określony sposób.</li>
        </ul>
      </section>

      <section>
        <pre class="text"><code class="hljs" data-trim>
          ng generate component user-mgmt/user-list
        </code></pre>

          <div class="r-hstack">
            <img src="img/new-user-list-component.png" alt="User list component" class="backlight white midtile">
            <img src="img/new-user-list-component-declared.png" alt="User list component declaration"
                   class="backlight white midtile">
          </div>
            <ul>
              <li><code class="bcol0">html</code> - szablon - część wizualna, ang. <em>template</em> (opcja)</li>
              <li><code class="bcol1">scss</code> - prywatny arkusz styli (opcja)</li>
              <li><code class="bcol2">component.ts</code> - kod/kontroler komponentu</li>
              <li><code class="bcol3">spec.ts</code> - testy jednostkowe komponentu (opcja)</li>
            </ul>
      </section>

      <section>
          <p>Definicja wyglądu komponentu w HTML:</p>
          <pre class="typescript"><code class="hljs" data-trim><script type="text/template">
            @Component({
              selector: 'app-user-list',
              template: `<p>Some fancy component...</p>`,
              styleUrls: ['./user-list.component.scss']
            })
            export class UserListComponent implements OnInit {
          </script>
          </code></pre>
          <p class="fragment" data-fragment-index="1">lub z użyciem zewnętrznego pliku:</p>
          <pre class="typescript fragment" data-fragment-index="1"><code class="hljs" data-trim><script type="text/template">
            @Component({
              selector: 'app-user-list',
              templateUrl: './user-list.component.html',
              styleUrls: ['./user-list.component.scss']
            })
            export class UserListComponent implements OnInit {
          </script></code></pre>
        </section>

        <section>
          <p><code>user-list.component.html</code></p>
          <pre class="html"><code class="hljs" data-trim data-line-numbers="|10|11-12"><script type="text/template">
            <section class='container-fluid'>
              <table class='table table-striped'>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor='let user of users'>
                    <td>{{user.name}}</td>
                    <td>{{user.email}}</td>
                  </tr>
                </tbody>
              </table>
            </section>
           </script></code></pre>
        </section>
    </section>

    <section>
      <h3>Model DOM</h3>
      <section>
        <p class=" rounded bcol3">DOM (<em>Document Object Model</em>) jest to model obiektowy reprezentujący dokument HTML
          wyświetlany przez przeglądarkę.</p>
        <div class="r-hstack">
          <p class="fragment bcol0 rounded">Przeglądarka buduje DOM w pamięci za każdym razem, gdy wyświetla HTML.</p>
          <p class="fragment bcol1 rounded">Każdy skrypt JavaScript (a więc także i każda aplikacja Angular) wchodzi w
            interakcję z DOM.</p>
        </div>
      </section>

      <section>
        <p class="bcol2">Postawowe API elementów DOM:</p>
        <table>
          <tr>
            <td><strong>atrybut</strong></td>
            <td>dodatkowa wartość definiująca tag (w dokumencie
              HTML)</td>
          </tr>
          <tr>
            <td><strong>właściwość</strong></td>
            <td>(<em>property</em>), właściwość obiektu DOM
              (zwykła właściwość obiektu w JS)</td>
          </tr>
          <tr>
            <td><strong>metoda</strong></td>
            <td>funkcja obiektu DOM, którą można wywołać</td>
          </tr>
          <tr>
            <td><strong>zdarzenie</strong></td>
            <td>(<em>event</em>) - informacja o zaistnieniu
              pewnego faktu, np <em>click</em>, <em>focus</em>, <em>blur</em></td>
          </tr>
        </table>
      </section>
    </section>

    <section>
      <h3>Data binding - wiązanie danych</h3>
      <section>
        <p><em>Data binding</em> są to mechanizmy pozwalające na integrację modelu z widokiem.</p>
      </section>
      <section>
        <table>
          <tr>
            <td><code>{{interpolation}}</code></td>
            <td>wyliczy wyrażenie wewnątrz <code>{{}}</code> oraz wstawi wartość</td>
          </tr>
          <tr>
            <td><code>[property_binding]</code></td>
            <td>Angular będzie aktualizował wartość właściwości na podstawie wyrażenia</td>
          </tr>
          <tr>
            <td><code>(event_binding)</code></td>
            <td>wywołana zostanie funkcja w reakcji na zaistnienie zdarzenia</td>
          </tr>
          <tr>
            <td><code>[(two_way_binding)]</code></td>
            <td>synchronizuje model z widokiem "w obie strony"</td>
          </tr>
        </table>
      </section>
    </section>

    <section>
      <section>
        <h3>Dyrektywy</h3>
        <p><em>Dyrektywy</em> to elementy rozszerzające funkcjonalność HTML, które można deklarować za pomocą Angular.</p>
        <p class="fragment" data-fragment-index="1">Istnieją trzy rodzaje dyrektyw:</p>
        <ul class="fragment" data-fragment-index="1">
          <li>Komponenty (już je znamy)</li>
          <li>Dyrektywy atrybutowe</li>
          <li>Dyrektywy strukturalne</li>
        </ul>
      </section>

      <section>
        <h3>Dyrektywy atrybutowe</h3>
        <div>
          <ul>
            <li><code>ngModel</code> - wiążą pola edycyjne z modelem</li>
            <li><code>ngClass</code> - pozwalają dynamicznie modyfikować klasy CSS</li>
            <li><code>ngStyle</code> - pozwalają dynamicznie modyfikować style CSS</li>
          </ul>
        </div>
      </section>

      <section>
        <h3>Dyrektywy atrybutowe</h3>
        <pre class="typescript"><code class="hljs" data-trim>
          divClasses = {};
          ...
          this.divClasses: {
            'valid': this.isValid(),
            'highlighted': this.isHighlighted()
          }
        </code></pre>

        <pre class="html"><code class="hljs" data-trim><script type="text/template">
          <div [ngClass]='divClasses'>...</div>
        </script></code></pre>

        <p>W prostszych przypadkach...</p>
        <pre class="html"><code class="hljs" data-trim><script type="text/template">
          <div [class.valid]='isValid()'>...</div>
        </script></code></pre>
      </section>

      <section>
        <h3>Dyrektywy strukturalne</h3>
        <div>
          <p class="align-left"><code>*ngIf</code> - dodaje/usuwa element z
            DOM: </p>
          <pre class="html"><code class="hljs" data-trim><script type="text/template">
            <div *ngIf='isVisible'>...</div>
          </script></code></pre>
          <p class="fragment align-left" data-fragment-index="2"><code>*ngfor</code> - iteruje po liście i
            dodaje element DOM dla każdego elementu listy:</p>
          <pre class="fragment html" data-fragment-index="2"><code class="hljs" data-trim><script type="text/template">
            <div *ngFor='let user of users'>{{user.name}} ({{user.email}})</div>
          </script></code></pre>
          <p class="fragment align-left" data-fragment-index="3"><code>ngSwitch, *ngSwitchCase,
            *ngSwitchDefault</code> - odpowiednik instrukcji switch/case/default z innych języków
            programowania.</p>
        </div>
      </section>
    </section>

    <section>
      <h3>Routing</h3>
      <section>
        <p>Jak działa przeglądarka?
        <div class="more-text">
          <ul>
            <li class="fragment">Wyświetla zawartość w zależności od wartości pola adresowego (URL).</li>
            <li class="fragment">Przekierowuje użytkownika na inną stronę w wyniku kliknięcia w link.</li>
            <li class="fragment">Zapamiętuje historię przeglądania oraz umożliwia poruszanie się po niej.
            </li>
          </ul>
        </div>
        </p>
        <p class="fragment more-text"><strong>Router jest modułem Angulara, który implementuje podstawowe
          funkcje przeglądarki (URL, historia) w aplikacjach typu Single-Page.</strong></p>
      </section>

      <section>
        <div class="col left">
          <img src="img/routing-setup-in-app.png" alt="Routing setup" height="380">
        </div>
        <div class="col right most-text">
          <ul>
            <li class="fragment">Router jest modułem Angulara instalowanym jako osobna zależność.</li>
            <li class="fragment">Dla każdej aplikacji Angulara potrzebujemy dokładnie jedną instację routera
              (singleton, <code>forRoot</code>).
            </li>
            <li class="fragment">Router inicjujemy tzw. tablicą przejść (ang. <em>routes</em>).</li>
            <li class="fragment">Wygodnie jest umieścić tablicę przejść (<code>import {APP_ROUTES}</code>) w
              osobnym
              pliku źródłowym.
            </li>
          </ul>
        </div>
      </section>

      <section>
        <div class="col left">
          <img src="img/routing-reorganized.png" alt="Routing reorganized">
        </div>
        <div class="col right">
          <p class="most-text fragment"><code>router-outlet</code> określa miejsce, w którym Router będzie
            "wklejał" nasz komponent.</p>
          <img src="img/router-outlet-src.png" alt="Router outlet source" class="fragment">
          <img src="img/router-outlet.png" alt="Router outlet" class="fragment">
        </div>
        <p class="most-text">Live coding: step5</p>
      </section>
      <section>
        <p> Więcej informacji na <a href="https://angular.io/guide/router">https://angular.io/guide/router</a>.
        </p>
      </section>
    </section>

    <section>
      <h3>Komunikacja międzykomponentowa</h3>
      <section>
        <div class="more-text">
          <p class="align-left">Angular pozwala na stosowanie <em>data bindings</em> we
            własnych komponentach.</p>
          <p class="fragment" data-fragment-index="1">Dla danych wejściowych:</p></div>
        <pre class="fragment" data-fragment-index="1"><code class="html">&lt;app-user-details [user]=&quot;user&quot;&gt;&lt;/app-user-details&gt;</code></pre>
        <pre class="fragment" data-fragment-index="2"><code class="javascript">
export class UserDetailsComponent
{
   ...
   @Input() user: User;
   ...
}</code></pre>
      </section>
      <section>
        <div class="more-text">
          <p>Dla danych wyjściowych:</p>
          <pre><code class="html">&lt;app-user-details (onChanged)=&quot;onChanged($event)&quot;&gt;&lt;/app-user-details&gt;</code></pre>
          <pre><code class="javascript">
export class UserDetailsComponent
{
   ...
   @Output() onChanged = new EventEmitter&lt;User&gt;();
   ...
   this.onChanged.emit(user);
   ...
}
                    </code></pre>
        </div>
      </section>
      <section>
        <p><strong>Przykład</strong>: edytor użytkowników</p>
        <img src="img/component-interaction-example.png" alt="Component interaction example">
        <p class="most-text">Live coding: step12, step13, step14, step15, step16</p>
      </section>
    </section>
    <section>
      <h3>Service</h3>

      <section>
        <p>Serwis jest funkcjonalnością aplikacji, która może być reużyta przez inne serwisy lub
          komponenty.</p>
        <p class="fragment more-text">Serwisy, po zaimplementowaniu, są dostępne dzięki mechanizmowi DI (<em>Dependency
          Injection</em>) Angulara.</p>
        <img src="img/service-data-provision-bad.png" alt="Service data provision" class="fragment">

      </section>
      <section>
                    <pre><code class="javascript">@Injectable()
export class UserService {

  users: User[] = [];

  constructor() {
    this.users = [
      {id: 1, name: 'John Doe', email: 'john.doe@email.com'},
      {id: 2, name: 'Max Rockatansky', email: 'mad.max@email.com'},
      {id: 3, name: 'Chuck Peddle', email: 'chuck@mos.com'}
    ];
  }
  getAllUsers() {
    return this.users;
  }

  saveUser(user: User) {
    const found = this.findUser(user.id);
    if (found) {
      Object.assign(found, user);
    } else {
      this.users.push(user);
    }
  }

  findUser(id: number) {
    return this.users.find((user: User) => user.id === id);
  }

  getNextId() {
    return this.users
      .map((elem: User) => elem.id)
      .reduce((prev, curr) => prev > curr ? prev : curr, 0) + 1;
  }
}
                    </code></pre>
        <p class="most-text">Live coding: step17</p>
      </section>
    </section>
    <section>
      <h3>HttpClient</h3>
      <pre><code class="javascript">@Injectable()
export class UserService {

  constructor(private http: Http) {
  }

  getAllUsers(): Observable&lt;Array&lt;User&gt;&gt; {
    return this.http.get('services/rest/users')
      .map(res =>  res.json());
  }

  findUser(id: number): Observable&lt;User&gt; {
    return this.http.get(`services/rest/users/${id}`)
      .map(res => res.json());
  }

  saveUser(user: User) {
    return this.http.post('services/rest/users', user);
  }
}

                </code></pre>
      <p class="most-text">Live coding: step18, step19</p>
    </section>
    <section>
      <h3>Bibliografia</h3>
      <div class="most-text">
        <ul>
          <li>
            <a href="https://angular.io/docs">https://angular.io/docs</a>, a w szczególności:
            <ul>
              <li><a href="https://angular.io/guide/router">https://angular.io/guide/router</a></li>
              <li>
                <a href="https://angular.io/guide/template-syntax">https://angular.io/guide/template-syntax</a>
              </li>
              <li><a href="https://angular.io/guide/component-interaction">https://angular.io/guide/component-interaction</a>
              </li>
              <li><a href="https://angular.io/guide/http">https://angular.io/guide/http</a></li>
            </ul>
          </li>
          <li><a href="https://blog.thoughtram.io/">https://blog.thoughtram.io/</a>, a w szczególności:
            <ul>
              <li>
                <a href="https://blog.thoughtram.io/angular/2015/08/11/angular-2-template-syntax-demystified-part-1.html">https://blog.thoughtram.io/angular/2015/08/11/angular-2-template-syntax-demystified-part-1.html</a>
              </li>
              <li>
                <a href="https://blog.thoughtram.io/angular/2016/10/13/two-way-data-binding-in-angular-2.html">https://blog.thoughtram.io/angular/2016/10/13/two-way-data-binding-in-angular-2.html</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </section>


  </div>
  <div
      id="cgLogo"
      style="background: url(img/cg-logo.svg); position: absolute; bottom: 20px; left: 20px; width: 170px; height: 38px;">
  </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/chalkboard/plugin.js"></script>
<script src="plugin/zoom/zoom.js"></script>

<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        width: 1200,
        hash: true,
        navigationMode: 'linear',
        slideNumber: 'c/t',
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealChalkboard, RevealZoom]
    });
</script>
</body>
</html>
